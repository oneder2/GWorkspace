# 用户使用指南

本文档详细说明如何使用 GWorkspace 的各项功能。

## 用户系统

### 注册和登录

1. **注册新用户**：
   - 点击页面右上角的用户图标
   - 选择"注册"（如果没有账号）
   - 填写用户名、邮箱和密码（至少6位）
   - 点击"注册"完成注册

2. **登录**：
   - 点击页面右上角的用户图标
   - 输入用户名和密码
   - 点击"登录"

3. **登出**：
   - 点击用户头像
   - 在下拉菜单中选择"登出"

### 创建管理员账户

管理员账户需要通过数据库直接创建。有两种方式：

**方式一：使用 SQLite 命令行工具**

```bash
cd backend
sqlite3 database/gworkspace.db

# 在 SQLite 命令行中执行：
INSERT INTO users (username, email, password_hash, role, created_at, updated_at)
VALUES ('admin', 'admin@example.com', '<bcrypt_hash>', 'admin', datetime('now'), datetime('now'));
```

**方式二：使用提供的脚本（推荐）**

项目已提供创建管理员账户的脚本：

1. 编辑 `backend/scripts/create-admin.js`，修改管理员信息：
   ```javascript
   const ADMIN_CONFIG = {
     username: 'admin',           // 修改为你的用户名
     email: 'admin@example.com',  // 修改为你的邮箱
     password: 'admin123456',      // 修改为你的密码
     role: 'admin'
   }
   ```

2. 运行脚本：
   ```bash
   cd backend
   npm run create-admin
   ```
   或者：
   ```bash
   cd backend
   node scripts/create-admin.js
   ```

脚本会自动检查用户是否已存在，避免重复创建。

## 管理后台

### 访问管理后台

1. 使用管理员账户登录
2. 点击用户头像，选择"管理后台"
3. 或直接访问 `http://localhost:3000/admin`

### 管理后台功能

**仪表盘** (`/admin`)
- 查看总体统计：总文章数、总浏览量、总点赞数、总评论数
- 快速操作：创建博客、管理博客、查看统计

**博客管理** (`/admin/blogs`)
- 查看所有博客（包括草稿）
- 创建新博客：点击"创建博客"按钮
- 编辑博客：点击文章行的编辑图标
- 删除博客：点击文章行的删除图标

**数据分析** (`/admin/analytics`)
- 查看访问统计：总访问量、独立访客数
- 查看热门文章排行

**评论管理** (`/admin/comments`)
- 查看所有评论
- 批准评论：点击"批准"按钮
- 标记垃圾评论：点击"标记垃圾"按钮
- 删除评论：点击"删除"按钮

### 管理员位置信息

系统会自动根据管理员的IP地址更新位置和时区信息：

- **自动更新时机**：
  - 管理员登录时：前端自动获取真实公网IP并更新位置信息
  - 管理员访问时：如果位置信息为空或是默认值，会自动更新
  
- **位置信息显示**：
  - 在页面顶部的时间下拉菜单中，会显示管理员的位置和时区
  - 位置信息包括：城市、国家、时区、IP地址
  
- **手动重新定位**：
  - 管理员可以在时间下拉菜单中点击定位图标，强制重新获取位置信息
  - 系统会调用IP定位API，更新管理员的位置、时区和IP地址

- **注意事项**：
  - 前端会自动获取真实公网IP，不受代理或NAT影响
  - 如果IP定位API服务不可用，系统会保留现有位置信息
  - 系统会自动检测并清除错误的默认位置值（如 "Beijing, China"）

## 博客管理

### 创建新博客

1. 登录管理员账户
2. 进入管理后台 → 博客管理
3. 点击"创建博客"按钮
4. 填写文章信息：
   - **标题**：文章标题
   - **分类 (Genre)**：文章分类，如 Tech、Design 等
   - **发布日期**：文章发布日期
   - **摘要**：文章摘要
   - **标签**：输入标签后按 Enter 添加
   - **内容**：Markdown 格式的文章内容
5. 点击"保存"提交

### 编辑博客

1. 在博客管理页面找到要编辑的文章
2. 点击文章行的编辑图标
3. 修改文章信息
4. 点击"保存"提交更改

### 删除博客

1. 在博客管理页面找到要删除的文章
2. 点击文章行的删除图标
3. 确认删除操作

## 用户功能

### 点赞文章

- **登录用户**：点击文章详情页的点赞按钮，点赞会与账户关联
- **匿名用户**：也可以点赞，但基于 IP 地址（同一 IP 只能点赞一次）

### 评论文章

- **登录用户**：在文章详情页底部填写评论，评论会显示用户名
- **匿名用户**：需要填写姓名和邮箱（可选），评论会显示提供的姓名

## 数据迁移

如果已有文件系统的博客文章，需要迁移到数据库：

```bash
npm run migrate
```

迁移脚本会：
1. 读取 `src/posts/` 目录下的所有文章
2. 将文章元数据和内容插入到数据库
3. 显示迁移结果统计

